<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Kubernetes By Example</title>
  <meta property="og:title" content="Kubernetes By Example" />
  <meta name="twitter:title" content="Kubernetes By Example" />
  <meta name="description" content="Guided Exercise: Configuring Cloud Applications Injecting Configuration Data into an Application In this exercise, you will use configuration maps and secrets to externalize the configuration for a containerized application.
Outcomes You should be able to:
  Deploy a simple Node.js-based application that prints configuration details from environment variables and files.
  Inject configuration data into the container using configuration maps and secrets.
  Change the data in the configuration map and verify that the application picks up the changed values.">
  <meta property="og:description" content="Guided Exercise: Configuring Cloud Applications Injecting Configuration Data into an Application In this exercise, you will use configuration maps and secrets to externalize the configuration for a containerized application.
Outcomes You should be able to:
  Deploy a simple Node.js-based application that prints configuration details from environment variables and files.
  Inject configuration data into the container using configuration maps and secrets.
  Change the data in the configuration map and verify that the application picks up the changed values.">
  <meta name="twitter:description" content="Guided Exercise: Configuring Cloud Applications Injecting Configuration Data into an Application In this exercise, you will use configuration maps and secrets to externalize the configuration for a â€¦">
  <meta name="author" content=""/>
  <link href='https://tonejito.github.io/kbe/img/kbe-logo.ico' rel='icon' type='image/x-icon'/>
  <meta property="og:image" content="https://tonejito.github.io/kbe/img/kbe-logo.png" />
  <meta name="twitter:image" content="https://tonejito.github.io/kbe/img/kbe-logo.png" />
  <meta name="twitter:card" content="summary" />
  <meta property="og:url" content="https://tonejito.github.io/kbe/learning-paths/application-development/lesson-4/cloud-practice/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Kubernetes By Example" />

  <meta name="generator" content="Hugo 0.91.2" />
  <link rel="canonical" href="https://tonejito.github.io/kbe/learning-paths/application-development/lesson-4/cloud-practice/" />
  <link rel="alternate" href="https://tonejito.github.io/index.xml" type="application/rss+xml" title="Kubernetes By Example">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://tonejito.github.io/kbe//css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://tonejito.github.io/kbe//css/pygment_highlights.css" />
  <link rel="stylesheet" href="https://tonejito.github.io/kbe//css/highlight.min.css" />
<link rel="stylesheet" type="text/css" href="https://tonejito.github.io/kbe/css/custom.css">


<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-WNHKJNX');</script>
  
</head>

  <body>
    
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WNHKJNX"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
<nav class="navbar navbar-default navbar-fixed-top navbar-custom" style="padding: 0px">

  

  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://tonejito.github.io/">Home</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Other topics</a>
              <div class="navlinks-children">
                
                  <a href="/kbe/topics/metallb/metallb/">MetalLB</a>
                
                  <a href="/kbe/topics/istio/istio/">Istio</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Concepts</a>
              <div class="navlinks-children">
                
                  <a href="/kbe/concepts/pods">Pods</a>
                
                  <a href="/kbe/concepts/labels">Labels</a>
                
                  <a href="/kbe/concepts/deployments">Deployments</a>
                
                  <a href="/kbe/concepts/services">Services</a>
                
                  <a href="/kbe/concepts/port-forwarding">Port Forwarding</a>
                
                  <a href="/kbe/concepts/health-checks">Health Checks</a>
                
                  <a href="/kbe/concepts/environment-variables">Environment Variables</a>
                
                  <a href="/kbe/concepts/namespaces">Namespaces</a>
                
                  <a href="/kbe/concepts/volumes">Volumes</a>
                
                  <a href="/kbe/concepts/persistent-volumes">Persistent Volumes</a>
                
                  <a href="/kbe/concepts/secrets">Secrets</a>
                
                  <a href="/kbe/concepts/logging">Logging</a>
                
                  <a href="/kbe/concepts/jobs">Jobs</a>
                
                  <a href="/kbe/concepts/nodes">Nodes</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Hands-on Examples</a>
              <div class="navlinks-children">
                
                  <a href="/kbe/sd/">Service Discovery</a>
                
                  <a href="/kbe/pf/">Port Forward</a>
                
                  <a href="/kbe/statefulset/">Stateful Sets</a>
                
                  <a href="/kbe/ic/">Init Containers</a>
                
                  <a href="/kbe/api/">API Server</a>
                
              </div>
            </li>
          
        
          
            <li>
              <a title="Contribute" href="https://github.com/openshift-evangelists/kbe.git">Contribute</a>
            </li>
          
        
          
            <li>
              <a title="Try out!" href="/kbe/diy/">Try out!</a>
            </li>
          
        

        

        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
          <a title="Kubernetes By Example" href="https://tonejito.github.io/">
            <img class="avatar-img" src="https://tonejito.github.io/kbe//img/kbe-logo.png" alt="Kubernetes By Example" />
          </a>
        
      </div>
    </div>

  </div>
</nav>




    
  
  
  




  <div class="intro-header"></div>


    
  <div class="container" role="main">
    <!-- https://kubebyexample.com/en/learning-paths/application-development-kubernetes/lesson-4-customize-deployments-application-5 -->
<h1 id="guided-exercise-configuring-cloud-applications">Guided Exercise: Configuring Cloud Applications</h1>
<h2 id="injecting-configuration-data-into-an-application">Injecting Configuration Data into an Application</h2>
<p>In this exercise, you will use configuration maps and secrets to externalize the configuration for a containerized application.</p>
<h2 id="outcomes">Outcomes</h2>
<p>You should be able to:</p>
<ul>
<li>
<p>Deploy a simple Node.js-based application that prints configuration details from environment variables and files.</p>
</li>
<li>
<p>Inject configuration data into the container using configuration maps and secrets.</p>
</li>
<li>
<p>Change the data in the configuration map and verify that the application picks up the changed values.</p>
</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<p>Ensure that:</p>
<ul>
<li>
<p>Minikube and kubectl are running on your machine</p>
</li>
<li>
<p>You have cloned the DO100-apps repository</p>
</li>
<li>
<p>You have executed the setup script located at DO100-apps/setup/operating-system/setup.sh</p>
</li>
</ul>
<p>Make sure your kubectl context uses the namespace username-dev. This allows you to execute kubectl commands directly into that namespace.</p>
<pre><code class="language-bash">[user@host ~]$ kubectl config set-context --current --namespace=username-dev
</code></pre>
<h2 id="instructions">Instructions</h2>
<ol>
<li>Review the application source code and deploy the application.</li>
</ol>
<p>1.1) Enter your local clone of the DO100-apps Git repository.</p>
<pre><code class="language-bash">[user@host ~]$ cd DO100-apps
</code></pre>
<p>1.2) Inspect the DO100-apps/app-config/app/app.js file.</p>
<p>The application reads the value of the APP_MSG environment variable and prints the contents of the /opt/app-root/secure/myapp.sec file:</p>
<pre><code class="language-text">const response = Value in the APP_MSG env var is =&gt; ${process.env.APP_MSG}\n;
...output omitted...
// Read in the secret file
fs.readFile('/opt/app-root/secure/myapp.sec', 'utf8', function (secerr,secdata) {
...output omitted...
</code></pre>
<p>1.3) Create a new deployment called app-config using the DO100-apps/app-config/kubernetes/deployment.yml file.</p>
<pre><code class="language-bash">[user@host DO100-apps]$ kubectl apply -f app-config/kubernetes/deployment.yml
deployment.apps/app-config created
</code></pre>
<ol start="2">
<li>Test the application.</li>
</ol>
<p>2.1) Expose the deployment on port 8080:</p>
<pre><code class="language-bash">[user@host DO100-apps]$ kubectl expose deployment/app-config --port 8080
service/app-config exposed
</code></pre>
<p>2.1) Modify the app-config/kubernetes/ingress.yml file to contain correct host value for your Kubernetes environment:</p>
<pre><code class="language-yaml">apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: app-config
  labels:
    app: app-config
spec:
  rules:
    - host: _INGRESS-HOST_
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: app-config
                port:
                  number: 8080
</code></pre>
<p>Replace <em>INGRESS-HOST</em> with the hostname associated with your Kubernetes cluster, such as hello.example.com or app-config-USER-dev.apps.sandbox.x8i5.p1.openshiftapps.com. If you are unsure of the hostname to use then refer to <a href="">Guided Exercise: Contrasting Kubernetes Distributions</a> to find the appropriate value.</p>
<p>2.2) Create the ingress resource to be able to invoke the service just exposed:</p>
<pre><code class="language-bash">[user@host DO100-apps]$ kubectl create -f app-config/kubernetes/ingress.yml
ingress.networking.k8s.io/app-config created
</code></pre>
<p>2.3) Invoke the host URL by using the curl command:</p>
<pre><code class="language-bash">[user@host DO100-apps]$ curl hello.example.com
Value in the APP_MSG env var is =&gt; undefined
Error: ENOENT: no such file or directory, open '/opt/app-root/secure/myapp.sec'
</code></pre>
<p>The undefined value for the environment variable and the ENOENT: no such file or directory error are shown because neither the environment variable nor the file exists in the container.</p>
<ol start="3">
<li>Create the configuration map and secret resources.</li>
</ol>
<p>3.1) Create a configuration map resource to hold configuration variables that store plain text data.</p>
<p>Create a new configuration map resource called appconfmap. Store a key called APP_MSG with the value Test Message in this configuration map:</p>
<blockquote>
<p><strong>Note</strong>:</p>
<p>This course uses the backslash character (<code>\</code>) to break long commands.
On Linux and macOS, you can use the line breaks.</p>
<p>On Windows, use the backtick character (<code>`</code>) to break long commands.</p>
<p>Alternatively, do not break long commands.</p>
</blockquote>
<pre><code class="language-bash">[user@host DO100-apps]$ kubectl create configmap appconfmap \
--from-literal APP_MSG=&quot;Test Message&quot;
configmap/appconfmap created
</code></pre>
<p>3.2) Verify that the configuration map contains the configuration data:</p>
<pre><code class="language-bash">[user@host DO100-apps]$ kubectl describe cm/appconfmap
Name:        appconfmap
...output omitted...
Data
====
APP_MSG:
---
Test Message
...output omitted...
</code></pre>
<p>3.3) Review the contents of the DO100-apps/app-config/app/myapp.sec file:</p>
<pre><code class="language-text">username=user1
password=pass1
salt=xyz123
</code></pre>
<p>3.4) Create a new secret to store the contents of the myapp.sec file.</p>
<pre><code class="language-bash">[user@host DO100-apps]$ kubectl create secret generic appconffilesec \
--from-file app-config/app/myapp.sec
secret/appconffilesec created
</code></pre>
<p>3.5) Verify the contents of the secret. Note that the contents are stored in base64-encoded format:</p>
<pre><code class="language-bash">[user@host DO100-apps]$ kubectl get secret/appconffilesec -o json
{
    &quot;apiVersion&quot;: &quot;v1&quot;,
    &quot;data&quot;: {
        &quot;myapp.sec&quot;: &quot;dXNlcm5hbWU9dXNlcjEKcGFzc3dvcmQ9cGFzczEKc2...
    },
    &quot;kind&quot;: &quot;Secret&quot;,
    &quot;metadata&quot;: {
        ...output omitted...
        &quot;name&quot;: &quot;appconffilesec&quot;,
        ...output omitted...
    },
    &quot;type&quot;: &quot;Opaque&quot;
}
</code></pre>
<ol start="4">
<li>Inject the configuration map and the secret into the application container.</li>
</ol>
<p>4.1) Use the kubectl set env command to add the configuration map to the deployment configuration:</p>
<pre><code class="language-bash">[user@host DO100-apps]$ kubectl set env deployment/app-config \
--from configmap/appconfmap
deployment.apps/app-config env updated
</code></pre>
<p>4.2) Use the kubectl patch command to add the secret to the deployment configuration:</p>
<p>Patch the app-config deployment using the following patch code. You can find this content in the DO100-apps/app-config/kubernetes/secret.yml file.</p>
<pre><code class="language-bash">[user@host DO100-apps]$ kubectl patch deployment app-config \
--patch-file app-config/kubernetes/secret.yml
deployment.apps/app-config patched
</code></pre>
<ol start="5">
<li>Verify that the application is redeployed and uses the data from the configuration map and the secret.</li>
</ol>
<p>5.1) Verify that the configuration map and secret were injected into the container. Retest the application using the route URL:</p>
<pre><code class="language-bash">[user@host DO100-apps]$ curl hello.example.com
Value in the APP_MSG env var is =&gt; Test Message
The secret is =&gt; username=user1
password=pass1
salt=xyz123
</code></pre>
<p>Kubernetes injects the configuration map as an environment variable and mounts the secret as a file into the container. The application reads the environment variable and file and then displays its data.</p>
<h2 id="finish">Finish</h2>
<p>Delete the created resources to clean your cluster. Kubernetes automatically deletes the associated pods.</p>
<pre><code class="language-bash">[user@host ~]$ kubectl delete all,ingress -l app=app-config
pod &quot;app-config-5cb9674bc5-wktrj&quot; deleted
service &quot;app-config&quot; deleted
deployment.apps &quot;app-config&quot; deleted
ingress.networking.k8s.io &quot;app-config&quot; deleted

[user@host ~]$ kubectl delete cm appconfmap
configmap &quot;appconfmap&quot; deleted

[user@host ~]$ kubectl delete secret appconffilesec
secret &quot;appconffilesec&quot; deleted
</code></pre>

  </div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
        </ul>
        <p class="credits copyright text-muted">
          
          &nbsp;&bull;&nbsp;
          2020

          
            &nbsp;&bull;&nbsp;
            <a href="https://tonejito.github.io/">Kubernetes By Example</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.91.2</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://tonejito.github.io/kbe//js/main.js"></script>
<script>

$('.language-test').parent().css('display', 'none')


var copybtns = {
  fallbackCopyTextToClipboard: function (text) {
    var txt = document.createElement("textarea");
    txt.value = text;
    
    
    txt.style.position = "fixed";
    txt.style.top = "0";
    txt.style.left = "0";
  
    document.body.appendChild(txt);
    txt.focus();
    txt.select();
    txt.setSelectionRange(0, 99999);
  
    try {
      var successful = document.execCommand('copy');
      var msg = successful ? 'successful' : 'unsuccessful';
    } catch (err) {
      console.error('Fallback: Unable to copy', err);
    }
  
    document.body.removeChild(txt);
  },
  copyTextToClipboard: function (text) {
    if (!navigator.clipboard) {
      copybtns.fallbackCopyTextToClipboard(text);
      return;
    }
    navigator.clipboard.writeText(text).then(function() {
      
    }, function(err) {
      
      copybtns.fallbackCopyTextToClipboard(text);
    });
  },
  flash: function(btn, content){
    
    content.fadeTo(50, 0.25, function() { $(this).fadeTo(300, 1.0); });
    
    btn.fadeTo(50, 0.0, function() { $(this).fadeTo(900, 1.0); });
  },
  txtClick : function(){
    var content = $(this);
    var btn = content.prev('button');
    
    copybtns.flash(btn, content);
    
    copybtns.copyTextToClipboard(content.text());
  },
  btnClick : function(){
    var btn = $(this);
    var content = $(btn.next().children()[0]);
    
    copybtns.flash(btn, content)
    
    copybtns.copyTextToClipboard(content.text());
  },
  init : function() {
    var buttonHTML = '<button type="button" data-toggle="tooltip" data-placement="top" title="Copy" class="copybtn btn btn-outline-dark"><img src="https:\/\/tonejito.github.io\/kbe\//img/Icon-Red_Hat-Media_and_documents-Paper_Stack_Blank-A-Black-RGB.png"/></button>';
    
    $('div.highlight').prepend(buttonHTML);
    
    $('button.copybtn').bind("click", copybtns.btnClick);
    $('div.highlight pre').bind("click", copybtns.txtClick);
  }
}
copybtns.init();
</script>
<script src="https://tonejito.github.io/kbe//js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> renderMathInElement(document.body); </script>






<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-34425776-2', 'auto');
	
	ga('send', 'pageview');
}
</script>

<div class="watermark-container">
  <div class="watermark">
    For testing purposes only
  </div>
  <div style="clear: both;"></div>
</div>



  </body>
</html>


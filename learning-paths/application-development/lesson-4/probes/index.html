<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Kubernetes By Example</title>
  <meta property="og:title" content="Kubernetes By Example" />
  <meta name="twitter:title" content="Kubernetes By Example" />
  <meta name="description" content="Liveness, Readiness, and Startup Probes Objectives After completing this section, you should be able to review how Kubernetes evaluates application health status via probes and automatic application restart.
Kubernetes Readiness and Liveness Probes Applications can become unreliable for a variety of reasons, for example:
 Temporary connection loss Configuration errors Application errors  Developers can use probes to monitor their applications. Probes make developers aware of events such as application status, resource usage, and errors.">
  <meta property="og:description" content="Liveness, Readiness, and Startup Probes Objectives After completing this section, you should be able to review how Kubernetes evaluates application health status via probes and automatic application restart.
Kubernetes Readiness and Liveness Probes Applications can become unreliable for a variety of reasons, for example:
 Temporary connection loss Configuration errors Application errors  Developers can use probes to monitor their applications. Probes make developers aware of events such as application status, resource usage, and errors.">
  <meta name="twitter:description" content="Liveness, Readiness, and Startup Probes Objectives After completing this section, you should be able to review how Kubernetes evaluates application health status via probes and automatic application â€¦">
  <meta name="author" content=""/>
  <link href='https://tonejito.github.io/kbe/img/kbe-logo.ico' rel='icon' type='image/x-icon'/>
  <meta property="og:image" content="https://tonejito.github.io/kbe/img/kbe-logo.png" />
  <meta name="twitter:image" content="https://tonejito.github.io/kbe/img/kbe-logo.png" />
  <meta name="twitter:card" content="summary" />
  <meta property="og:url" content="https://tonejito.github.io/kbe/learning-paths/application-development/lesson-4/probes/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Kubernetes By Example" />

  <meta name="generator" content="Hugo 0.91.2" />
  <link rel="canonical" href="https://tonejito.github.io/kbe/learning-paths/application-development/lesson-4/probes/" />
  <link rel="alternate" href="https://tonejito.github.io/index.xml" type="application/rss+xml" title="Kubernetes By Example">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://tonejito.github.io/kbe//css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://tonejito.github.io/kbe//css/pygment_highlights.css" />
  <link rel="stylesheet" href="https://tonejito.github.io/kbe//css/highlight.min.css" />
<link rel="stylesheet" type="text/css" href="https://tonejito.github.io/kbe/css/custom.css">


<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-WNHKJNX');</script>
  
</head>

  <body>
    
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WNHKJNX"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
<nav class="navbar navbar-default navbar-fixed-top navbar-custom" style="padding: 0px">

  

  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://tonejito.github.io/">Home</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Other topics</a>
              <div class="navlinks-children">
                
                  <a href="/kbe/topics/metallb/metallb/">MetalLB</a>
                
                  <a href="/kbe/topics/istio/istio/">Istio</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Concepts</a>
              <div class="navlinks-children">
                
                  <a href="/kbe/concepts/pods">Pods</a>
                
                  <a href="/kbe/concepts/labels">Labels</a>
                
                  <a href="/kbe/concepts/deployments">Deployments</a>
                
                  <a href="/kbe/concepts/services">Services</a>
                
                  <a href="/kbe/concepts/port-forwarding">Port Forwarding</a>
                
                  <a href="/kbe/concepts/health-checks">Health Checks</a>
                
                  <a href="/kbe/concepts/environment-variables">Environment Variables</a>
                
                  <a href="/kbe/concepts/namespaces">Namespaces</a>
                
                  <a href="/kbe/concepts/volumes">Volumes</a>
                
                  <a href="/kbe/concepts/persistent-volumes">Persistent Volumes</a>
                
                  <a href="/kbe/concepts/secrets">Secrets</a>
                
                  <a href="/kbe/concepts/logging">Logging</a>
                
                  <a href="/kbe/concepts/jobs">Jobs</a>
                
                  <a href="/kbe/concepts/nodes">Nodes</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Hands-on Examples</a>
              <div class="navlinks-children">
                
                  <a href="/kbe/sd/">Service Discovery</a>
                
                  <a href="/kbe/pf/">Port Forward</a>
                
                  <a href="/kbe/statefulset/">Stateful Sets</a>
                
                  <a href="/kbe/ic/">Init Containers</a>
                
                  <a href="/kbe/api/">API Server</a>
                
              </div>
            </li>
          
        
          
            <li>
              <a title="Contribute" href="https://github.com/openshift-evangelists/kbe.git">Contribute</a>
            </li>
          
        
          
            <li>
              <a title="Try out!" href="/kbe/diy/">Try out!</a>
            </li>
          
        

        

        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
          <a title="Kubernetes By Example" href="https://tonejito.github.io/">
            <img class="avatar-img" src="https://tonejito.github.io/kbe//img/kbe-logo.png" alt="Kubernetes By Example" />
          </a>
        
      </div>
    </div>

  </div>
</nav>




    
  
  
  




  <div class="intro-header"></div>


    
  <div class="container" role="main">
    <!-- https://kubebyexample.com/en/learning-paths/application-development-kubernetes/lesson-4-customize-deployments-application-2 -->
<h1 id="liveness-readiness-and-startup-probes">Liveness, Readiness, and Startup Probes</h1>
<h2 id="objectives">Objectives</h2>
<p>After completing this section, you should be able to review how Kubernetes evaluates application health status via probes and automatic application restart.</p>
<h2 id="kubernetes-readiness-and-liveness-probes">Kubernetes Readiness and Liveness Probes</h2>
<p>Applications can become unreliable for a variety of reasons, for example:</p>
<ul>
<li>Temporary connection loss</li>
<li>Configuration errors</li>
<li>Application errors</li>
</ul>
<p>Developers can use probes to monitor their applications. Probes make developers aware of events such as application status, resource usage, and errors.</p>
<p>Monitoring of such events is useful for fixing problems, but can also help with resource planning and managing.</p>
<p>A probe is a periodic check that monitors the health of an application. Developers can configure probes by using either the kubectl command-line client or a YAML deployment template.</p>
<p>There are currently three types of probes in Kubernetes:</p>
<dl>
<dt><strong>Startup Probe</strong></dt>
<dd>A startup probe verifies whether the application within a container is started.</dd>
<dd>Startup probes run before any other probe, and, unless it finishes successfully, disables other probes.</dd>
<dd>If a container fails its startup probe, then the container is killed and follows the pod&rsquo;s restartPolicy.</dd>
</dl>
<p>This type of probe is only executed at startup, unlike readiness probes, which are run periodically.</p>
<p>The startup probe is configured in the spec.containers.startupprobe attribute of the pod configuration.</p>
<dl>
<dt><strong>Readiness Probe</strong></dt>
<dd>Readiness probes determine whether or not a container is ready to serve requests.
If the readiness probe returns a failed state, then Kubernetes removes the IP address for the container from the endpoints of all Services.</dd>
</dl>
<p>Developers use readiness probes to instruct Kubernetes that a running container should not receive any traffic. This is useful when waiting for an application to perform time-consuming initial tasks, such as establishing network connections, loading files, and warming caches.</p>
<p>The readiness probe is configured in the spec.containers.readinessprobe attribute of the pod configuration.</p>
<dl>
<dt><strong>Liveness Probe</strong></dt>
<dd>Liveness probes determine whether or not an application running in a container is in a healthy state.</dd>
<dd>If the liveness probe detects an unhealthy state, then Kubernetes kills the container and tries to redeploy it.</dd>
</dl>
<p>The liveness probe is configured in the spec.containers.livenessprobe attribute of the pod configuration.</p>
<p>Kubernetes provides five options that control these probes:</p>
<table>
<thead>
<tr>
<th style="text-align:center">Name</th>
<th style="text-align:center">Mandatory</th>
<th style="text-align:center">Default Value</th>
<th style="text-align:center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>initialDelaySeconds</code></td>
<td style="text-align:center">Yes</td>
<td style="text-align:center">0</td>
<td style="text-align:center">Determines how long to wait after the container starts before beginning the probe.</td>
</tr>
<tr>
<td style="text-align:center"><code>timeoutSeconds</code></td>
<td style="text-align:center">Yes</td>
<td style="text-align:center">1</td>
<td style="text-align:center">Determines how long to wait for the probe to finish. If this time is exceeded, then Kubernetes assumes that the probe failed.</td>
</tr>
<tr>
<td style="text-align:center"><code>periodSeconds</code></td>
<td style="text-align:center">No</td>
<td style="text-align:center">10</td>
<td style="text-align:center">Specifies the frequency of the checks.</td>
</tr>
<tr>
<td style="text-align:center"><code>successThreshold</code></td>
<td style="text-align:center">No</td>
<td style="text-align:center">1</td>
<td style="text-align:center">Specifies the minimum consecutive successes for the probe to be considered successful after it has failed.</td>
</tr>
<tr>
<td style="text-align:center"><code>failureThreshold</code></td>
<td style="text-align:center">No</td>
<td style="text-align:center">3</td>
<td style="text-align:center">Specifies the minimum consecutive failures for the probe to be considered failed after it has succeeded.</td>
</tr>
</tbody>
</table>
<h2 id="methods-of-checking-application-health">Methods of Checking Application Health</h2>
<p>Startup, readiness, and liveness probes can check the health of applications in three ways: HTTP checks, container execution checks, and TCP socket checks.</p>
<h3 id="http-checks">HTTP Checks</h3>
<p>An HTTP check is ideal for applications that return HTTP status codes, such as REST APIs.</p>
<p>HTTP probe uses GET requests to check the health of an application. The check is successful if the HTTP response code is in the range 200-399.</p>
<p>The following example demonstrates how to implement a readiness probe with the HTTP check method:</p>
<pre><code class="language-yaml">...contents omitted...
readinessProbe:
  httpGet:
    path: /health (1)
    port: 8080
  initialDelaySeconds: 15 (2)
  timeoutSeconds: 1 (3)
...contents omitted...
</code></pre>
<ol>
<li>
<p>The readiness probe endpoint.</p>
</li>
<li>
<p>How long to wait after the container starts before checking its health.</p>
</li>
<li>
<p>How long to wait for the probe to finish.</p>
</li>
</ol>
<h3 id="container-execution-checks">Container Execution Checks</h3>
<p>Container execution checks are ideal in scenarios where you must determine the status of the container based on the exit code of a process or shell script running in the container.</p>
<p>When using container execution checks Kubernetes executes a command inside the container. Exiting the check with a status of 0 is considered a success. All other status codes are considered a failure.</p>
<p>The following example demonstrates how to implement a container execution check:</p>
<pre><code class="language-yaml">...contents omitted...
livenessProbe:
  exec:
    command: (1)
    - cat
    - /tmp/health
  initialDelaySeconds: 15
  timeoutSeconds: 1
...contents omitted...
</code></pre>
<ol>
<li>The command to run and its arguments, as a YAML array.</li>
</ol>
<h3 id="tcp-socket-checks">TCP Socket Checks</h3>
<p>A TCP socket check is ideal for applications that run as daemons, and open TCP ports, such as database servers, file servers, web servers, and application servers.</p>
<p>When using TCP socket checks Kubernetes attempts to open a socket to the container. The container is considered healthy if the check can establish a successful connection.</p>
<p>The following example demonstrates how to implement a liveness probe by using the TCP socket check method:</p>
<pre><code class="language-yaml">...contents omitted...
livenessProbe:
  tcpSocket:
    port: 8080 (1)
  initialDelaySeconds: 15
  timeoutSeconds: 1
...contents omitted...
</code></pre>
<ol>
<li>The TCP port to check.</li>
</ol>
<h2 id="creating-probes">Creating Probes</h2>
<p>To configure probes on a deployment, edit the deployment&rsquo;s resource definition. To do this, you can use the kubectl edit or kubectl patch commands. Alternatively, if you already have a deployment YAML definition, you can modify it to include the probes and then apply it with kubectl apply.</p>
<p>The following example demonstrates using the kubectl edit command to add a readiness probe to a deployment:</p>
<blockquote>
<p><strong>Note</strong>:</p>
<p>This will open your system&rsquo;s default editor with the deployment definition.
Once you make the necessary changes, save and quit the editor to apply them.</p>
</blockquote>
<pre><code class="language-bash">[user@host ~]$ kubectl set probe deployment myapp --readiness \
--get-url=http://:8080/healthz --period=20

[user@host ~]$ kubectl patch deployment myapp \
-p '{&quot;spec&quot;:{&quot;containers&quot;[0]: {&quot;readinessProbe&quot;: {}}}}'
</code></pre>
<p>The following examples demonstrate using the kubectl set probe command with a variety of options:</p>
<pre><code class="language-bash">[user@host ~]$ kubectl set probe deployment myapp --readiness \
--get-url=http://:8080/healthz --period=20

[user@host ~]$ kubectl set probe deployment myapp --liveness \
--open-tcp=3306 --period=20 \
--timeout-seconds=1

[user@host ~]$ kubectl set probe deployment myapp --liveness \
--get-url=http://:8080/healthz --initial-delay-seconds=30 \
--success-threshold=1 --failure-threshold=3
</code></pre>

  </div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
        </ul>
        <p class="credits copyright text-muted">
          
          &nbsp;&bull;&nbsp;
          2020

          
            &nbsp;&bull;&nbsp;
            <a href="https://tonejito.github.io/">Kubernetes By Example</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.91.2</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://tonejito.github.io/kbe//js/main.js"></script>
<script>

$('.language-test').parent().css('display', 'none')


var copybtns = {
  fallbackCopyTextToClipboard: function (text) {
    var txt = document.createElement("textarea");
    txt.value = text;
    
    
    txt.style.position = "fixed";
    txt.style.top = "0";
    txt.style.left = "0";
  
    document.body.appendChild(txt);
    txt.focus();
    txt.select();
    txt.setSelectionRange(0, 99999);
  
    try {
      var successful = document.execCommand('copy');
      var msg = successful ? 'successful' : 'unsuccessful';
    } catch (err) {
      console.error('Fallback: Unable to copy', err);
    }
  
    document.body.removeChild(txt);
  },
  copyTextToClipboard: function (text) {
    if (!navigator.clipboard) {
      copybtns.fallbackCopyTextToClipboard(text);
      return;
    }
    navigator.clipboard.writeText(text).then(function() {
      
    }, function(err) {
      
      copybtns.fallbackCopyTextToClipboard(text);
    });
  },
  flash: function(btn, content){
    
    content.fadeTo(50, 0.25, function() { $(this).fadeTo(300, 1.0); });
    
    btn.fadeTo(50, 0.0, function() { $(this).fadeTo(900, 1.0); });
  },
  txtClick : function(){
    var content = $(this);
    var btn = content.prev('button');
    
    copybtns.flash(btn, content);
    
    copybtns.copyTextToClipboard(content.text());
  },
  btnClick : function(){
    var btn = $(this);
    var content = $(btn.next().children()[0]);
    
    copybtns.flash(btn, content)
    
    copybtns.copyTextToClipboard(content.text());
  },
  init : function() {
    var buttonHTML = '<button type="button" data-toggle="tooltip" data-placement="top" title="Copy" class="copybtn btn btn-outline-dark"><img src="https:\/\/tonejito.github.io\/kbe\//img/Icon-Red_Hat-Media_and_documents-Paper_Stack_Blank-A-Black-RGB.png"/></button>';
    
    $('div.highlight').prepend(buttonHTML);
    
    $('button.copybtn').bind("click", copybtns.btnClick);
    $('div.highlight pre').bind("click", copybtns.txtClick);
  }
}
copybtns.init();
</script>
<script src="https://tonejito.github.io/kbe//js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> renderMathInElement(document.body); </script>






<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-34425776-2', 'auto');
	
	ga('send', 'pageview');
}
</script>

<div class="watermark-container">
  <div class="watermark">
    For testing purposes only
  </div>
  <div style="clear: both;"></div>
</div>



  </body>
</html>


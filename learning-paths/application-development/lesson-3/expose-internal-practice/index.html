<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Kubernetes By Example</title>
  <meta property="og:title" content="Kubernetes By Example" />
  <meta name="twitter:title" content="Kubernetes By Example" />
  <meta name="description" content="Guided Exercise: Exposing Applications for Internal Access In this exercise you will deploy two apps in different namespaces. They communicate by using the built-in Kubernetes DNS resolution system.
Outcomes You should be able to:
 Create a service using kubectl expose Create a service using a manifest Use DNS resolution for service communication  Prerequisites Ensure that:
 Minikube and kubectl are running on your machine You have cloned the DO100-apps repository You have executed the setup script  Instructions To illustrate how communication is handled in Kubernetes, you use two applications.">
  <meta property="og:description" content="Guided Exercise: Exposing Applications for Internal Access In this exercise you will deploy two apps in different namespaces. They communicate by using the built-in Kubernetes DNS resolution system.
Outcomes You should be able to:
 Create a service using kubectl expose Create a service using a manifest Use DNS resolution for service communication  Prerequisites Ensure that:
 Minikube and kubectl are running on your machine You have cloned the DO100-apps repository You have executed the setup script  Instructions To illustrate how communication is handled in Kubernetes, you use two applications.">
  <meta name="twitter:description" content="Guided Exercise: Exposing Applications for Internal Access In this exercise you will deploy two apps in different namespaces. They communicate by using the built-in Kubernetes DNS resolution system. â€¦">
  <meta name="author" content=""/>
  <link href='https://tonejito.github.io/kbe/img/kbe-logo.ico' rel='icon' type='image/x-icon'/>
  <meta property="og:image" content="https://tonejito.github.io/kbe/img/kbe-logo.png" />
  <meta name="twitter:image" content="https://tonejito.github.io/kbe/img/kbe-logo.png" />
  <meta name="twitter:card" content="summary" />
  <meta property="og:url" content="https://tonejito.github.io/kbe/learning-paths/application-development/lesson-3/expose-internal-practice/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Kubernetes By Example" />

  <meta name="generator" content="Hugo 0.91.2" />
  <link rel="canonical" href="https://tonejito.github.io/kbe/learning-paths/application-development/lesson-3/expose-internal-practice/" />
  <link rel="alternate" href="https://tonejito.github.io/index.xml" type="application/rss+xml" title="Kubernetes By Example">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://tonejito.github.io/kbe//css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://tonejito.github.io/kbe//css/pygment_highlights.css" />
  <link rel="stylesheet" href="https://tonejito.github.io/kbe//css/highlight.min.css" />
<link rel="stylesheet" type="text/css" href="https://tonejito.github.io/kbe/css/custom.css">


<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-WNHKJNX');</script>
  
</head>

  <body>
    
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WNHKJNX"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
<nav class="navbar navbar-default navbar-fixed-top navbar-custom" style="padding: 0px">

  

  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://tonejito.github.io/">Home</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Other topics</a>
              <div class="navlinks-children">
                
                  <a href="/kbe/topics/metallb/metallb/">MetalLB</a>
                
                  <a href="/kbe/topics/istio/istio/">Istio</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Concepts</a>
              <div class="navlinks-children">
                
                  <a href="/kbe/concepts/pods">Pods</a>
                
                  <a href="/kbe/concepts/labels">Labels</a>
                
                  <a href="/kbe/concepts/deployments">Deployments</a>
                
                  <a href="/kbe/concepts/services">Services</a>
                
                  <a href="/kbe/concepts/port-forwarding">Port Forwarding</a>
                
                  <a href="/kbe/concepts/health-checks">Health Checks</a>
                
                  <a href="/kbe/concepts/environment-variables">Environment Variables</a>
                
                  <a href="/kbe/concepts/namespaces">Namespaces</a>
                
                  <a href="/kbe/concepts/volumes">Volumes</a>
                
                  <a href="/kbe/concepts/persistent-volumes">Persistent Volumes</a>
                
                  <a href="/kbe/concepts/secrets">Secrets</a>
                
                  <a href="/kbe/concepts/logging">Logging</a>
                
                  <a href="/kbe/concepts/jobs">Jobs</a>
                
                  <a href="/kbe/concepts/nodes">Nodes</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Hands-on Examples</a>
              <div class="navlinks-children">
                
                  <a href="/kbe/sd/">Service Discovery</a>
                
                  <a href="/kbe/pf/">Port Forward</a>
                
                  <a href="/kbe/statefulset/">Stateful Sets</a>
                
                  <a href="/kbe/ic/">Init Containers</a>
                
                  <a href="/kbe/api/">API Server</a>
                
              </div>
            </li>
          
        
          
            <li>
              <a title="Contribute" href="https://github.com/openshift-evangelists/kbe.git">Contribute</a>
            </li>
          
        
          
            <li>
              <a title="Try out!" href="/kbe/diy/">Try out!</a>
            </li>
          
        

        

        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
          <a title="Kubernetes By Example" href="https://tonejito.github.io/">
            <img class="avatar-img" src="https://tonejito.github.io/kbe//img/kbe-logo.png" alt="Kubernetes By Example" />
          </a>
        
      </div>
    </div>

  </div>
</nav>




    
  
  
  




  <div class="intro-header"></div>


    
  <div class="container" role="main">
    <!-- https://kubebyexample.com/en/learning-paths/application-development-kubernetes/lesson-3-networking-kubernetes/guided-exercise -->
<h1 id="guided-exercise-exposing-applications-for-internal-access"><strong>Guided Exercise</strong>: Exposing Applications for Internal Access</h1>
<p>In this exercise you will deploy two apps in different namespaces. They communicate by using the built-in Kubernetes DNS resolution system.</p>
<h2 id="outcomes">Outcomes</h2>
<p>You should be able to:</p>
<ul>
<li>Create a service using kubectl expose</li>
<li>Create a service using a manifest</li>
<li>Use DNS resolution for service communication</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<p>Ensure that:</p>
<ul>
<li>Minikube and kubectl are running on your machine</li>
<li>You have cloned the DO100-apps repository</li>
<li>You have executed the setup script</li>
</ul>
<h2 id="instructions">Instructions</h2>
<p>To illustrate how communication is handled in Kubernetes, you use two applications.</p>
<ul>
<li>
<p>The name-generator app produces random names that can be consumed in the /random-name endpoint.</p>
</li>
<li>
<p>The email-generator app produces random emails that can be consumed in the /random-email endpoint.</p>
</li>
<li>
<p>The email-generator app consumes name-generator to include a random name in the emails that it generates.</p>
</li>
</ul>
<p>Make sure your kubectl context uses the namespace username-dev. This allows you to execute kubectl commands directly into that namespace.</p>
<pre><code class="language-bash">[user@host DO100-apps]$ kubectl config set-context \
    --current --namespace=username-dev
</code></pre>
<ol>
<li>Deploy the name-generator app in the username-dev namespace.</li>
</ol>
<p>1.1) Open a command-line terminal. In the DO100-apps repository, navigate to the name-generator folder.</p>
<p>1.2) Use the kubectl apply command to create a Deployment from the manifest located in the kubernetes directory. It creates three replicas of the name-generator app by using the quay.io/redhattraining/do100-name-generator:v1.0 image.</p>
<pre><code class="language-bash">[user@host name-generator]$ kubectl apply -f kubernetes/deployment.yml
deployment.apps/name-generator created
</code></pre>
<p>1.3) List the deployments to verify it has been created successfully. Use the command kubectl get deployment.</p>
<pre><code class="language-bash">[user@host name-generator]$ kubectl get deployment
NAME             READY   UP-TO-DATE   AVAILABLE   AGE
name-generator   3/3     3            3           90m
</code></pre>
<ol start="2">
<li>Create a Service for the deployment of the name-generator app by using the kubectl expose command.</li>
</ol>
<p>2.1) Using the deployment name, expose the service at port number 80. The following command creates a service that forwards requests on port 80 for the DNS name name-generator.namespace.local-domain to containers created by the name-generator deployment on port 8080.</p>
<pre><code class="language-bash">[user@host name-generator]$ kubectl expose deployment name-generator --port 80 --target-port=8080
service/name-generator exposed
</code></pre>
<p>2.2) List the services to verify that the name-generator service has been created successfully. Use the command kubectl get service.</p>
<pre><code class="language-bash">[user@host name-generator]$ kubectl get service
NAME             TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE
name-generator   ClusterIP   10.98.55.248   &lt;none&gt;        80/TCP    31s
</code></pre>
<ol start="3">
<li>Review the code of the email-generator to see how the request to the name-generator is made. Deploy the app in the username-dev namespace.</li>
</ol>
<p>3.1) In the DO100-apps repository, navigate to the email-generator folder.</p>
<p>3.2) In the app directory, open the server.js file. The server.js file is a NodeJS application, which exposes the endpoint /random-email on the 8081 port.</p>
<p>3.3) In the same folder, open the generate-email.js file. The generateEmail method generates a random email by making an HTTP request to the name-generator service.</p>
<p>3.4) The getNameFromExternalService method performs the actual HTTP request. The host, which is the name-generator service name, is defined in the NAME_GENERATOR_URL variable.</p>
<p>3.5) On the command line, return to the email-generator folder.</p>
<p>3.6) Apply the Deployment manifest in the username-dev namespace. It is located in the kubernetes folder and creates three replicas of the email-generator app by using the quay.io/redhattraining/do100-email-generator:v1.0 image.</p>
<pre><code class="language-bash">[user@host email-generator]$ kubectl apply -f kubernetes/deployment.yml
deployment.apps/email-generator created
</code></pre>
<p>3.7) List the deployments in the namespace to verify it has been created successfully. Use the command kubectl get deployment.</p>
<pre><code class="language-bash">[user@host email-generator]$ kubectl get deployment
NAME              READY   UP-TO-DATE   AVAILABLE   AGE
email-generator   3/3     3            3           5s
name-generator    3/3     3            3           66m
</code></pre>
<ol start="4">
<li>Create a service for the deployment of the email-generator app by using a manifest.</li>
</ol>
<p>4.1) Apply the Service manifest in the username-dev namespace. It is located in the kubernetes folder. Use the kubectl apply command.</p>
<p>This command exposes the service in the 80 port and targets port 8081, which is where the email-generator app serves.</p>
<pre><code class="language-bash">[user@host email-generator]$ kubectl apply -f kubernetes/service.yml
service/email-generator created
</code></pre>
<p>4.2) List the services to verify that the email-generator service has been created successfully. Use the command kubectl get service.</p>
<pre><code class="language-bash">[user@host email-generator]$ kubectl get service
NAME              TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
email-generator   ClusterIP   10.108.68.139   &lt;none&gt;        80/TCP     3s
name-generator    ClusterIP   10.109.14.167   &lt;none&gt;        80/TCP     68m
</code></pre>
<ol start="5">
<li>Verify that everything works properly by making an HTTP request to the email-generator app from the username-stage namespace. The result should contain a name plus some numbers at the end.</li>
</ol>
<p>5.1) To make a request to the email-generator app from another namespace, you use the Kubernetes DNS resolution pattern service-name.namespace. In this case, the host is email-generator.username-dev.</p>
<p>5.2) Create a temporary pod that enables you to make a request to the email-generator application. Run the following command, which provides you with a terminal to execute curl.</p>
<pre><code class="language-bash">[user@host email-generator]$ kubectl run -n username-stage \
    curl -it --rm --image=registry.access.redhat.com/ubi8/ubi-minimal -- sh
</code></pre>
<p>Note that:</p>
<ul>
<li>
<p>The command creates a pod named curl in the username-stage namespace.</p>
</li>
<li>
<p>The pod contains one container that uses the registry.access.redhat.com/ubi8/ubi-minimal container image.</p>
</li>
<li>
<p>After Kubernetes creates the pod, you create an interactive remote shell session into the pod.</p>
</li>
<li>
<p>When you exit out of the interactive session, Kubernetes terminates the pod.</p>
</li>
</ul>
<p>The command might take some time to execute. If you see the message If you don&rsquo;t see a command prompt, try pressing enter., then press Enter on your keyboard and the terminal opens.</p>
<p>5.3) In the terminal, make an HTTP request to the email-generator service by using curl. Because the service runs on the default HTTP port (80), you do not need to specify the port. You can also omit the local DNS domain.</p>
<pre><code class="language-bash">$ curl http://email-generator.username-dev/random-email
</code></pre>
<p>You should see a response in JSON format similar to this:</p>
<pre><code class="language-json">{&quot;email&quot;:&quot;username@host.tld&quot;}
</code></pre>
<p>5.4) Type exit to exit the terminal. The pod used to make the request is automatically deleted.</p>
<h2 id="finish">Finish</h2>
<p>Remove all resources used in this exercise.</p>
<p>You can delete all resources in the namespace with the following command:</p>
<pre><code class="language-bash">[user@host email-generator]$ kubectl delete all --all
pod &quot;email-generator-ff5fdf658-bz8v2&quot; deleted
pod &quot;email-generator-ff5fdf658-k6ln6&quot; deleted
pod &quot;email-generator-ff5fdf658-pn466&quot; deleted
pod &quot;name-generator-9744675d-4kmp9&quot; deleted
pod &quot;name-generator-9744675d-grw9g&quot; deleted
pod &quot;name-generator-9744675d-tlpz9&quot; deleted
service &quot;email-generator&quot; deleted
service &quot;name-generator&quot; deleted
deployment.apps &quot;email-generator&quot; deleted
deployment.apps &quot;name-generator&quot; deleted
</code></pre>
<p>Alternatively, you can delete the resources individually. Delete both the email-generator and name-generator services:</p>
<pre><code class="language-bash">[user@host email-generator]$ kubectl delete service email-generator
service &quot;email-generator&quot; deleted

[user@host email-generator]$ kubectl delete service name-generator
service &quot;name-generator&quot; deleted
</code></pre>
<p>Delete both the email-generator and name-generator deployments:</p>
<pre><code class="language-bash">[user@host email-generator]$ kubectl delete deployment email-generator
deployment.apps &quot;email-generator&quot; deleted

[user@host email-generator]$ kubectl delete deployment name-generator
deployment.apps &quot;name-generator&quot; deleted
</code></pre>
<p>This concludes the guided exercise.</p>

  </div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
        </ul>
        <p class="credits copyright text-muted">
          
          &nbsp;&bull;&nbsp;
          2020

          
            &nbsp;&bull;&nbsp;
            <a href="https://tonejito.github.io/">Kubernetes By Example</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.91.2</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://tonejito.github.io/kbe//js/main.js"></script>
<script>

$('.language-test').parent().css('display', 'none')


var copybtns = {
  fallbackCopyTextToClipboard: function (text) {
    var txt = document.createElement("textarea");
    txt.value = text;
    
    
    txt.style.position = "fixed";
    txt.style.top = "0";
    txt.style.left = "0";
  
    document.body.appendChild(txt);
    txt.focus();
    txt.select();
    txt.setSelectionRange(0, 99999);
  
    try {
      var successful = document.execCommand('copy');
      var msg = successful ? 'successful' : 'unsuccessful';
    } catch (err) {
      console.error('Fallback: Unable to copy', err);
    }
  
    document.body.removeChild(txt);
  },
  copyTextToClipboard: function (text) {
    if (!navigator.clipboard) {
      copybtns.fallbackCopyTextToClipboard(text);
      return;
    }
    navigator.clipboard.writeText(text).then(function() {
      
    }, function(err) {
      
      copybtns.fallbackCopyTextToClipboard(text);
    });
  },
  flash: function(btn, content){
    
    content.fadeTo(50, 0.25, function() { $(this).fadeTo(300, 1.0); });
    
    btn.fadeTo(50, 0.0, function() { $(this).fadeTo(900, 1.0); });
  },
  txtClick : function(){
    var content = $(this);
    var btn = content.prev('button');
    
    copybtns.flash(btn, content);
    
    copybtns.copyTextToClipboard(content.text());
  },
  btnClick : function(){
    var btn = $(this);
    var content = $(btn.next().children()[0]);
    
    copybtns.flash(btn, content)
    
    copybtns.copyTextToClipboard(content.text());
  },
  init : function() {
    var buttonHTML = '<button type="button" data-toggle="tooltip" data-placement="top" title="Copy" class="copybtn btn btn-outline-dark"><img src="https:\/\/tonejito.github.io\/kbe\//img/Icon-Red_Hat-Media_and_documents-Paper_Stack_Blank-A-Black-RGB.png"/></button>';
    
    $('div.highlight').prepend(buttonHTML);
    
    $('button.copybtn').bind("click", copybtns.btnClick);
    $('div.highlight pre').bind("click", copybtns.txtClick);
  }
}
copybtns.init();
</script>
<script src="https://tonejito.github.io/kbe//js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> renderMathInElement(document.body); </script>






<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-34425776-2', 'auto');
	
	ga('send', 'pageview');
}
</script>

<div class="watermark-container">
  <div class="watermark">
    For testing purposes only
  </div>
  <div style="clear: both;"></div>
</div>



  </body>
</html>


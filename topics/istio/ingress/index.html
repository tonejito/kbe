<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Kubernetes By Example</title>
  <meta property="og:title" content="Kubernetes By Example" />
  <meta name="twitter:title" content="Kubernetes By Example" />
  <meta name="description" content="Guided Exercise - Configuring Istio Ingress Control">
  <meta property="og:description" content="Guided Exercise - Configuring Istio Ingress Control">
  <meta name="twitter:description" content="Guided Exercise - Configuring Istio Ingress Control">
  <meta name="author" content=""/>
  <link href='https://tonejito.github.io/kbe/img/kbe-logo.ico' rel='icon' type='image/x-icon'/>
  <meta property="og:image" content="https://tonejito.github.io/kbe/img/kbe-logo.png" />
  <meta name="twitter:image" content="https://tonejito.github.io/kbe/img/kbe-logo.png" />
  <meta name="twitter:card" content="summary" />
  <meta property="og:url" content="https://tonejito.github.io/kbe/topics/istio/ingress/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Kubernetes By Example" />

  <meta name="generator" content="Hugo 0.91.2" />
  <link rel="canonical" href="https://tonejito.github.io/kbe/topics/istio/ingress/" />
  <link rel="alternate" href="https://tonejito.github.io/index.xml" type="application/rss+xml" title="Kubernetes By Example">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://tonejito.github.io/kbe//css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://tonejito.github.io/kbe//css/pygment_highlights.css" />
  <link rel="stylesheet" href="https://tonejito.github.io/kbe//css/highlight.min.css" />
<link rel="stylesheet" type="text/css" href="https://tonejito.github.io/kbe/css/custom.css">


<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-WNHKJNX');</script>
  
</head>

  <body>
    
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WNHKJNX"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
<nav class="navbar navbar-default navbar-fixed-top navbar-custom" style="padding: 0px">

  

  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://tonejito.github.io/">Home</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Hands-on Examples</a>
              <div class="navlinks-children">
                
                  <a href="/kbe/pods/">Pods</a>
                
                  <a href="/kbe/labels/">Labels</a>
                
                  <a href="/kbe/deployments/">Deployments</a>
                
                  <a href="/kbe/services/">Services</a>
                
                  <a href="/kbe/sd/">Service Discovery</a>
                
                  <a href="/kbe/pf/">Port Forward</a>
                
                  <a href="/kbe/healthz/">Health Checks</a>
                
                  <a href="/kbe/concepts/environment-variables">Environment Variables</a>
                
                  <a href="/kbe/ns/">Namespaces</a>
                
                  <a href="/kbe/volumes/">Volumes</a>
                
                  <a href="/kbe/concepts/persistent-volumes">Persistent Volumes</a>
                
                  <a href="/kbe/secrets/">Secrets</a>
                
                  <a href="/kbe/logging/">Logging</a>
                
                  <a href="/kbe/concepts/jobs">Jobs</a>
                
                  <a href="/kbe/statefulset/">Stateful Sets</a>
                
                  <a href="/kbe/ic/">Init Containers</a>
                
                  <a href="/kbe/nodes/">Nodes</a>
                
                  <a href="/kbe/api/">API Server</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Other topics</a>
              <div class="navlinks-children">
                
                  <a href="/kbe/topics/metallb/metallb/">MetalLB</a>
                
                  <a href="/kbe/topics/istio/istio/">Istio</a>
                
              </div>
            </li>
          
        
          
            <li>
              <a title="Contribute" href="https://github.com/openshift-evangelists/kbe.git">Contribute</a>
            </li>
          
        
          
            <li>
              <a title="Try out!" href="/kbe/diy/">Try out!</a>
            </li>
          
        

        

        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
          <a title="Kubernetes By Example" href="https://tonejito.github.io/">
            <img class="avatar-img" src="https://tonejito.github.io/kbe//img/kbe-logo.png" alt="Kubernetes By Example" />
          </a>
        
      </div>
    </div>

  </div>
</nav>




    
  
  
  




  <div class="intro-header"></div>


    
  <div class="container" role="main">
    <table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 10%;"/>
<col style="width: 80%;"/>
<col style="width: 10%;"/>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><a href="../ingress-control">‚è™</a></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><a href="../../../">üè†</a></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><a href="../traffic-management">‚è©</a></p>
</div></div></td>
</tr>
</tbody>
</table>
<hr/>
<div class="sect1">
<h2 id="_guided_exercise_configuring_istio_ingress_control">Guided Exercise: Configuring Istio Ingress Control</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this exercise, you will configure the ingress resource to access the Kubernetes dashboard.</p>
</div>
<div class="paragraph">
<p>Outcomes</p>
</div>
<div class="paragraph">
<p>You should be able to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deploy the Kubernetes dashboard add-on in the minikube cluster.</p>
</li>
<li>
<p>Configure the ingress resource to access the application from outside the cluster.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To perform this exercise, ensure that you have:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>minikube</code>, and <code>kubectl</code> executables version 1.24 or later on a directory listed in <code>PATH</code>.</p>
</li>
<li>
<p>MetalLB installed in the cluster.
You can consult the <a href="../../metallb/install">installation guided exercise</a>.</p>
</li>
<li>
<p>Istio installed in the cluster.
You can consult the <a href="../../istio/install">installation guided exercise</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The minikube Istio add-on is outdated and cannot be installed in recent versions of Kubernetes.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Procedure instructions</p>
</div>
<div class="paragraph">
<p>1) Start the minikube instance, and verify that MetalLB and Istio are installed.</p>
</div>
<div class="paragraph">
<p>1.1) Start the minikube instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ minikube start
...output omitted...</code></pre>
</div>
</div>
<div class="paragraph">
<p>1.2) Verify that the pods in the <code>metallb-system</code> namespace are running.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ kubectl get pods -n metallb-system
NAME                          READY   STATUS    RESTARTS   AGE
controller-66bc445b99-2gv6w   1/1     Running   0          2d
speaker-jxjdm                 1/1     Running   0          2d</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>This guided exercise assumes that MetalLB is <a href="../../metallb/install">installed and configured</a>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>1.3) Verify that MetalLB has the IP address range configured.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ kubectl get configmap config -n metallb-system -o yaml
apiVersion: v1
data:
  config: |
    address-pools:
    - name: default
      protocol: layer2
      addresses:
      - 192.168.59.20-192.168.59.30
...output omitted...</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>If the IP address range for MetalLB is empty, then review the troubleshooting section in the <a href="../../metallb/metallb">MetalLB lecture</a>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>1.4) Verify that the deployments in the <code>istio-system</code> namespace are running.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ kubectl get deployments -n istio-system
NAME                   READY   UP-TO-DATE   AVAILABLE   AGE
grafana                1/1     1            1           1d
istio-egressgateway    1/1     1            1           1d
istio-ingressgateway   1/1     1            1           1d
istiod                 1/1     1            1           1d
jaeger                 1/1     1            1           1d
kiali                  1/1     1            1           1d
prometheus             1/1     1            1           1d</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>This guided exercise assumes that Istio is <a href="../../istio/install">installed and configured</a>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>2) Enable the Kubernetes dashboard, and metrics server minikube add-ons.</p>
</div>
<div class="paragraph">
<p>2.1) Verify if <code>dashboard</code>, and <code>metrics-server</code> are listed in the available add-ons for minikube.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ minikube addons list
|--------------------------|----------|------------|-----------------------|
|        ADDON NAME        | PROFILE  |   STATUS   |      MAINTAINER       |
|--------------------------|----------|------------|-----------------------|
| ambassador               | minikube | disabled   | unknown (third-party) |
| auto-pause               | minikube | disabled   | google                |
| csi-hostpath-driver      | minikube | disabled   | kubernetes            |
| dashboard                | minikube | disabled   | kubernetes            | # <b class="conum">(1)</b>
| default-storageclass     | minikube | enabled ‚úÖ | kubernetes            |
| efk                      | minikube | disabled   | unknown (third-party) |
| freshpod                 | minikube | disabled   | google                |
| gcp-auth                 | minikube | disabled   | google                |
| gvisor                   | minikube | disabled   | google                |
| helm-tiller              | minikube | disabled   | unknown (third-party) |
| ingress                  | minikube | disabled   | unknown (third-party) |
| ingress-dns              | minikube | disabled   | unknown (third-party) |
| istio                    | minikube | disabled   | unknown (third-party) |
| istio-provisioner        | minikube | disabled   | unknown (third-party) |
| kubevirt                 | minikube | disabled   | unknown (third-party) |
| logviewer                | minikube | disabled   | google                |
| metallb                  | minikube | enabled ‚úÖ | unknown (third-party) |
| metrics-server           | minikube | disabled   | kubernetes            | # <b class="conum">(2)</b>
| nvidia-driver-installer  | minikube | disabled   | google                |
| nvidia-gpu-device-plugin | minikube | disabled   | unknown (third-party) |
| olm                      | minikube | disabled   | unknown (third-party) |
| pod-security-policy      | minikube | disabled   | unknown (third-party) |
| portainer                | minikube | disabled   | portainer.io          |
| registry                 | minikube | disabled   | google                |
| registry-aliases         | minikube | disabled   | unknown (third-party) |
| registry-creds           | minikube | disabled   | unknown (third-party) |
| storage-provisioner      | minikube | enabled ‚úÖ | kubernetes            |
| volumesnapshots          | minikube | disabled   | kubernetes            |
|--------------------------|----------|------------|-----------------------|
üí° To see addons list for other profiles use: `minikube addons -p name list`</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The dashboard add-on is listed, but is disabled.</p>
</li>
<li>
<p>The metrics-server add-on is listed, but is disabled.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>2.2) Enable the dashboard minikube add-on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ minikube addons enable dashboard
    ‚ñ™ Using image kubernetesui/dashboard:v2.3.1
    ‚ñ™ Using image kubernetesui/metrics-scraper:v1.0.7
üí°  Some dashboard features require the metrics-server addon.
    To enable all features please run:

	minikube addons enable metrics-server

üåü  The &#39;dashboard&#39; addon is enabled</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The Kubernetes dashboard on the minikube instance is exposed without role-based access control (RBAC) <strong>for testing purposes only</strong>.</p>
</div>
<div class="paragraph">
<p>You should deploy RBAC on any Kubernetes dashboard instance that is exposed to the network.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/kubernetes/dashboard/blob/v2.3.1/docs/user/access-control/creating-sample-user.md" class="bare">https://github.com/kubernetes/dashboard/blob/v2.3.1/docs/user/access-control/creating-sample-user.md</a></p>
</li>
</ul>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>2.3) Enable the metrics server minikube add-on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ minikube addons enable metrics-server
    ‚ñ™ Using image k8s.gcr.io/metrics-server/metrics-server:v0.4.2
üåü  The &#39;metrics-server&#39; addon is enabled</code></pre>
</div>
</div>
<div class="paragraph">
<p>2.4) Wait until the deployments in the <code>kubernetes-dashboard</code> and <code>kube-system</code> namespaces are ready.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ kubectl get deployments -n kubernetes-dashboard
NAME                        READY   UP-TO-DATE   AVAILABLE   AGE
dashboard-metrics-scraper   1/1     1            1           60s
kubernetes-dashboard        1/1     1            1           60s

[user@host kbe]$ kubectl get deployments -n kube-system
NAME             READY   UP-TO-DATE   AVAILABLE   AGE
coredns          1/1     1            1           2d
metrics-server   1/1     1            1           50s</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You might need to repeat the commands until the desired conditions are reached.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>2.5) List the services in the <code>kubernetes-dashboard</code>, and <code>kube-system</code> namespaces.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ kubectl get services -n kubernetes-dashboard
NAME                       TYPE       CLUSTER-IP     EXTERNAL-IP  PORT(S)   AGE
dashboard-metrics-scraper  ClusterIP  10.111.37.183  &lt;none&gt;       8000/TCP  5m
kubernetes-dashboard       ClusterIP  10.106.151.75  &lt;none&gt;       80/TCP    5m

[user@host kbe]$ kubectl get services -n kube-system
NAME           TYPE      CLUSTER-IP     EXTERNAL-IP PORT(S)                 AGE
kube-dns       ClusterIP 10.96.0.10     &lt;none&gt;      53/UDP,53/TCP,9153/TCP  2d
metrics-server ClusterIP 10.105.213.184 &lt;none&gt;      443/TCP                 5m</code></pre>
</div>
</div>
<div class="paragraph">
<p>3) Retrieve the Istio ingress IP address and port.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>This GE assumes that the IP address for the ingress load balancer service is provided by MetalLB.
If MetalLB is not deployed, then the service internal IP address and node port number should be used instead.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>3.1) Get the Istio ingress IP address.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ kubectl get service istio-ingressgateway \
  -n istio-system \
  -o jsonpath=&#39;{.status.loadBalancer.ingress[0].ip}{&#34;\n&#34;}&#39;
192.168.59.20

[user@host kbe]$ export INGRESS_HOST=&#34;192.168.59.20&#34;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can export the IP address by using a single command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ export INGRESS_HOST=$(kubectl get service \
  istio-ingressgateway -n istio-system \
  -o jsonpath=&#39;{.status.loadBalancer.ingress[0].ip}&#39;)</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>3.2) Get the Istio ingress port numbers for the HTTP and HTTPS endpoints.
The service ports match the standard port numbers because MetalLB provided an IP address for the Istio load balancer service.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ kubectl get service istio-ingressgateway \
  -n istio-system \
  -o jsonpath=&#39;{.spec.ports[?(@.name==&#34;http2&#34;)].port}{&#34;\n&#34;}&#39;
80

[user@host kbe]$ export INGRESS_PORT=&#34;80&#34;

[user@host kbe]$ kubectl get service istio-ingressgateway \
  -n istio-system \
  -o jsonpath=&#39;{.spec.ports[?(@.name==&#34;https&#34;)].port}{&#34;\n&#34;}&#39;
443

[user@host kbe]$ export SECURE_INGRESS_PORT=&#34;443&#34;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can export the port numbers by using a single command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ export INGRESS_PORT=$(kubectl get service \
  istio-ingressgateway -n istio-system \
  -o jsonpath=&#39;{.spec.ports[?(@.name==&#34;http2&#34;)].port}&#39;)

[user@host kbe]$ export SECURE_INGRESS_PORT=$(kubectl get service \
  istio-ingressgateway -n istio-system \
  -o jsonpath=&#39;{.spec.ports[?(@.name==&#34;https&#34;)].port}&#39;)</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>4) Prepare the Kubernetes dashboard namespace for Istio.</p>
</div>
<div class="paragraph">
<p>4.1) Enable the sidecar injection for the <code>kubernetes-dashboard</code> namespace to add an <code>istio-proxy</code> container on each pod to control ingress and egress traffic.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ kubectl label namespace kubernetes-dashboard istio-injection=enabled --overwrite
namespace/kubernetes-dashboard labeled</code></pre>
</div>
</div>
<div class="paragraph">
<p>4.2) Get the list of pods and deployments on the <code>kubernetes-dashboard</code> namespace.
The <strong>ready</strong> status displays <code>1/1</code> indicating that there is only one container running on each pod.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ kubectl get pods -n kubernetes-dashboard
NAME                                         READY   STATUS    RESTARTS   AGE
dashboard-metrics-scraper-5594458c94-wnxhp   1/1     Running   0          10m
kubernetes-dashboard-654cf69797-gzfg6        1/1     Running   0          10m

[user@host kbe]$ kubectl get deployments -n kubernetes-dashboard
NAME                        READY   UP-TO-DATE   AVAILABLE   AGE
dashboard-metrics-scraper   1/1     1            1           10m
kubernetes-dashboard        1/1     1            1           10m</code></pre>
</div>
</div>
<div class="paragraph">
<p>4.2) Restart all deployments in the <code>kubernetes-dashboard</code> namespace to inject the <code>istio-proxy</code> container into all pods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ kubectl rollout restart deployment kubernetes-dashboard -n kubernetes-dashboard
deployment.apps/kubernetes-dashboard restarted

[user@host kbe]$ kubectl rollout restart deployment dashboard-metrics-scraper -n kubernetes-dashboard
deployment.apps/dashboard-metrics-scraper restarted</code></pre>
</div>
</div>
<div class="paragraph">
<p>4.3) Wait until all the pods in the <code>kubernetes-dashboard</code> namespace are ready.
The <strong>ready</strong> status displays <code>2/2</code> indicating that there are now two containers running on each pod.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ kubectl get pods -n kubernetes-dashboard
NAME                                         READY   STATUS    RESTARTS     AGE
dashboard-metrics-scraper-79d469dbbf-kn7sz   2/2     Running   0            90s
kubernetes-dashboard-556974bd8c-xcm9p        2/2     Running   1 (2m ago)   2m2s</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You might need to repeat the command until the desired condition is reached.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>4.4) List the container names of each pod in the <code>kubernetes-dashboard</code> namespace.
The <code>istio-proxy</code> container is listed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ kubectl get pods -n kubernetes-dashboard \
  -l &#34;k8s-app=kubernetes-dashboard&#34; \
  -o jsonpath=&#39;{.items[*].spec.containers[*].name}{&#34;\n&#34;}&#39;
kubernetes-dashboard istio-proxy

[user@host kbe]$ kubectl get pods -n kubernetes-dashboard \
  -l &#34;k8s-app=dashboard-metrics-scraper&#34; \
  -o jsonpath=&#39;{.items[*].spec.containers[*].name}{&#34;\n&#34;}&#39;
dashboard-metrics-scraper istio-proxy</code></pre>
</div>
</div>
<div class="paragraph">
<p>5) Configure Istio ingress for the Kubernetes dashboard.</p>
</div>
<div class="paragraph">
<p>5.1) List the IP address of the ingress host that you obtained previously.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ printenv INGRESS_HOST
192.168.59.20</code></pre>
</div>
</div>
<div class="paragraph">
<p>5.2) List the information for the <code>kubernetes-dashboard</code> service.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ kubectl get service kubernetes-dashboard -n kubernetes-dashboard
NAME                   TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE
kubernetes-dashboard   ClusterIP   10.98.184.102   &lt;none&gt;        80/TCP    20h</code></pre>
</div>
</div>
<div class="paragraph">
<p>5.3) Create a file called <code>dashboard-ingress.yaml</code> with the following content.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Replace the <code>192.168.59.20</code> string with your value for <code>INGRESS_HOST</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: kubernetes-dashboard
  namespace: kubernetes-dashboard
  annotations:
    kubernetes.io/ingress.class: istio  # <b class="conum">(1)</b>
spec:
  rules:
  - host: dashboard.192.168.59.20.nip.io  # <b class="conum">(2)</b>
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: kubernetes-dashboard  # <b class="conum">(3)</b>
            port:
              number: 80  # <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The annotation is required to tell the Istio gateway controller that it should handle this ingress resource, otherwise it is ignored.</p>
</li>
<li>
<p>DNS host name where the ingress serves traffic.</p>
</li>
<li>
<p>Back-end service name.</p>
</li>
<li>
<p>Back-end service port number.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The YAML indentation in this file is set to <strong>two white spaces</strong>.</p>
</div>
<div class="paragraph">
<p>There is a <code>dashboard-ingress.yaml</code> file in the KBE repository in case you want to check for syntax errors.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../../../specs/istio/dashboard-ingress.yaml">specs/istio/dashboard-ingress.yaml</a></p>
</li>
<li>
<p><a href="https://github.com/openshift-evangelists/kbe/raw/main/specs/istio/dashboard-ingress.yaml" class="bare">https://github.com/openshift-evangelists/kbe/raw/main/specs/istio/dashboard-ingress.yaml</a></p>
</li>
</ul>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>5.4) Apply the YAML manifest to create the ingress resource.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ kubectl apply -n kubernetes-dashboard -f dashboard-ingress.yaml
ingress.networking.k8s.io/kubernetes-dashboard created</code></pre>
</div>
</div>
<div class="paragraph">
<p>5.5) List the ingress resources in the <code>kubernetes-dashboard</code> namespace</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ kubectl get ingresses -n kubernetes-dashboard
NAME                  CLASS  HOSTS                           ADDRESS  PORTS  AGE
kubernetes-dashboard  istio  dashboard.192.168.59.20.nip.io           80     60s</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The Kubernetes dashboard on the minikube instance is exposed on an HTTP endpoint without SSL <strong>for testing purposes only</strong>.</p>
</div>
<div class="paragraph">
<p>You should deploy any Kubernetes dashboard instance that is exposed to the network with an SSL endpoint.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://istio.io/latest/docs/tasks/traffic-management/ingress/secure-ingress/" class="bare">https://istio.io/latest/docs/tasks/traffic-management/ingress/secure-ingress/</a></p>
</li>
</ul>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>5.6) Verify that the back-end service responds.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Replace the <code>192.168.59.20</code> string with your value for <code>INGRESS_HOST</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ printenv INGRESS_HOST
192.168.59.20

[user@host kbe]$ curl -vk# &#39;http://dashboard.192.168.59.20.nip.io/&#39; | egrep &#39;&lt;/?title&gt;&#39;
*   Trying 192.168.59.20...
* TCP_NODELAY set
* Connected to dashboard.192.168.59.20.nip.io (192.168.59.20) port 80 (#0)
&gt; GET / HTTP/1.1
&gt; Host: dashboard.192.168.59.20.nip.io
&gt; User-Agent: curl/7.61.1
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 200 OK
&lt; accept-ranges: bytes
&lt; cache-control: no-cache, no-store, must-revalidate
&lt; content-length: 1338
&lt; content-type: text/html; charset=utf-8
&lt; last-modified: Wed, 16 Jun 2021 10:53:38 GMT
&lt; date: Mon, 14 Feb 2022 22:43:50 GMT
&lt; x-envoy-upstream-service-time: 0
&lt; server: istio-envoy
&lt;
{ [1338 bytes data]
######################################################################### 100.0%
* Connection #0 to host dashboard.192.168.59.20.nip.io left intact

&lt;title&gt;Kubernetes Dashboard&lt;/title&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>5.7) Visit the service URL with a web browser to see the page.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><uri>http://dashboard.192.168.59.20.nip.io/</uri></code></p>
</li>
<li>
<p>Replace the <code>192.168.59.20</code> string with your value for <code>INGRESS_HOST</code>.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Kubernetes dashboard served with Istio ingress</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><div class="content"><div class="imageblock text-center">
<div class="content">
<img src="../../../img/istio/ingress-001-kubernetes-dashboard.png" alt="Kubernetes dashboard served with Istio ingress" width="100%"/>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>6) Clean up.</p>
</div>
<div class="paragraph">
<p>6.1) Delete the Kubernetes dashboard ingress resource.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[user@host kbe]$ kubectl delete ingress kubernetes-dashboard -n kubernetes-dashboard
ingress.networking.k8s.io &#34;kubernetes-dashboard&#34; deleted</pre>
</div>
</div>
<div class="paragraph">
<p>6.2) Remove the label from the <code>kubernetes-dashboard</code> namespace.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ kubectl label namespace kubernetes-dashboard istio-injection-
namespace/kubernetes-dashboard labeled</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The dash at the end of the command is used to instruct <code>kubectl</code> to remove the label.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>6.3) Restart all deployments in the <code>kubernetes-dashboard</code> namespace to create new pods without the <code>istio-proxy</code> container.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ kubectl rollout restart deployment kubernetes-dashboard -n kubernetes-dashboard
deployment.apps/kubernetes-dashboard restarted

[user@host kbe]$ kubectl rollout restart deployment dashboard-metrics-scraper -n kubernetes-dashboard
deployment.apps/dashboard-metrics-scraper restarted</code></pre>
</div>
</div>
<div class="paragraph">
<p>This concludes the guided exercise.</p>
</div>
<hr/>
<div class="paragraph">
<p>References</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://istio.io/latest/docs/tasks/traffic-management/ingress/kubernetes-ingress/" class="bare">https://istio.io/latest/docs/tasks/traffic-management/ingress/kubernetes-ingress/</a></p>
</li>
<li>
<p><a href="https://istio.io/latest/docs/tasks/traffic-management/ingress/secure-ingress/" class="bare">https://istio.io/latest/docs/tasks/traffic-management/ingress/secure-ingress/</a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/" class="bare">https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/</a></p>
</li>
<li>
<p><a href="https://github.com/kubernetes/dashboard/tree/v2.3.1" class="bare">https://github.com/kubernetes/dashboard/tree/v2.3.1</a></p>
</li>
<li>
<p><a href="https://github.com/kubernetes/dashboard/blob/v2.3.1/docs/user/access-control/creating-sample-user.md" class="bare">https://github.com/kubernetes/dashboard/blob/v2.3.1/docs/user/access-control/creating-sample-user.md</a></p>
</li>
<li>
<p><a href="https://github.com/kubernetes-sigs/metrics-server/tree/v0.4.2" class="bare">https://github.com/kubernetes-sigs/metrics-server/tree/v0.4.2</a></p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 10%;"/>
<col style="width: 80%;"/>
<col style="width: 10%;"/>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><a href="../ingress-control">‚è™</a></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><a href="../../../">üè†</a></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><a href="../traffic-management">‚è©</a></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>

  </div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
        </ul>
        <p class="credits copyright text-muted">
          
          &nbsp;&bull;&nbsp;
          2020

          
            &nbsp;&bull;&nbsp;
            <a href="https://tonejito.github.io/">Kubernetes By Example</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.91.2</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://tonejito.github.io/kbe//js/main.js"></script>
<script>

$('.language-test').parent().css('display', 'none')


var copybtns = {
  fallbackCopyTextToClipboard: function (text) {
    var txt = document.createElement("textarea");
    txt.value = text;
    
    
    txt.style.position = "fixed";
    txt.style.top = "0";
    txt.style.left = "0";
  
    document.body.appendChild(txt);
    txt.focus();
    txt.select();
    txt.setSelectionRange(0, 99999);
  
    try {
      var successful = document.execCommand('copy');
      var msg = successful ? 'successful' : 'unsuccessful';
    } catch (err) {
      console.error('Fallback: Unable to copy', err);
    }
  
    document.body.removeChild(txt);
  },
  copyTextToClipboard: function (text) {
    if (!navigator.clipboard) {
      copybtns.fallbackCopyTextToClipboard(text);
      return;
    }
    navigator.clipboard.writeText(text).then(function() {
      
    }, function(err) {
      
      copybtns.fallbackCopyTextToClipboard(text);
    });
  },
  flash: function(btn, content){
    
    content.fadeTo(50, 0.25, function() { $(this).fadeTo(300, 1.0); });
    
    btn.fadeTo(50, 0.0, function() { $(this).fadeTo(900, 1.0); });
  },
  txtClick : function(){
    var content = $(this);
    var btn = content.prev('button');
    
    copybtns.flash(btn, content);
    
    copybtns.copyTextToClipboard(content.text());
  },
  btnClick : function(){
    var btn = $(this);
    var content = $(btn.next().children()[0]);
    
    copybtns.flash(btn, content)
    
    copybtns.copyTextToClipboard(content.text());
  },
  init : function() {
    var buttonHTML = '<button type="button" data-toggle="tooltip" data-placement="top" title="Copy" class="copybtn btn btn-outline-dark"><img src="https:\/\/tonejito.github.io\/kbe\//img/Icon-Red_Hat-Media_and_documents-Paper_Stack_Blank-A-Black-RGB.png"/></button>';
    
    $('div.highlight').prepend(buttonHTML);
    
    $('button.copybtn').bind("click", copybtns.btnClick);
    $('div.highlight pre').bind("click", copybtns.txtClick);
  }
}
copybtns.init();
</script>
<script src="https://tonejito.github.io/kbe//js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> renderMathInElement(document.body); </script>






<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-34425776-2', 'auto');
	
	ga('send', 'pageview');
}
</script>

<div class="watermark-container">
  <div class="watermark">
    For testing purposes only
  </div>
  <div style="clear: both;"></div>
</div>



  </body>
</html>


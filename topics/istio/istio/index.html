<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Kubernetes By Example</title>
  <meta property="og:title" content="Kubernetes By Example" />
  <meta name="twitter:title" content="Kubernetes By Example" />
  <meta name="description" content="Istio is an ingress controller and a service mesh implementation for Kubernetes">
  <meta property="og:description" content="Istio is an ingress controller and a service mesh implementation for Kubernetes">
  <meta name="twitter:description" content="Istio is an ingress controller and a service mesh implementation for Kubernetes">
  <meta name="author" content=""/>
  <link href='https://tonejito.github.io/kbe/img/kbe-logo.ico' rel='icon' type='image/x-icon'/>
  <meta property="og:image" content="https://tonejito.github.io/kbe/img/kbe-logo.png" />
  <meta name="twitter:image" content="https://tonejito.github.io/kbe/img/kbe-logo.png" />
  <meta name="twitter:card" content="summary" />
  <meta property="og:url" content="https://tonejito.github.io/kbe/topics/istio/istio/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Kubernetes By Example" />

  <meta name="generator" content="Hugo 0.91.2" />
  <link rel="canonical" href="https://tonejito.github.io/kbe/topics/istio/istio/" />
  <link rel="alternate" href="https://tonejito.github.io/index.xml" type="application/rss+xml" title="Kubernetes By Example">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://tonejito.github.io/kbe//css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://tonejito.github.io/kbe//css/pygment_highlights.css" />
  <link rel="stylesheet" href="https://tonejito.github.io/kbe//css/highlight.min.css" />
<link rel="stylesheet" type="text/css" href="https://tonejito.github.io/kbe/css/custom.css">


<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-WNHKJNX');</script>
  
</head>

  <body>
    
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WNHKJNX"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
<nav class="navbar navbar-default navbar-fixed-top navbar-custom" style="padding: 0px">

  
  <div class="container-fluid alert alert-warning alert-dismissible show annoying-banner-ad" style='color:white; background: #53b9fc; font-size:small;' role="alert">
    <strong>Kubernetes By Example is evolving!</strong>
    <br/>
    On June 15, you will find more hands-on trainings using real world use cases and an improved site navigation and interface to make it easier for you to build skills with Kubernetes.
    <br/>
    Don't worry, you'll still have access to all the current Kubernetes learning resources on KBE.
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  

  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://tonejito.github.io/">Home</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Hands-on Examples</a>
              <div class="navlinks-children">
                
                  <a href="/kbe/pods/">Pods</a>
                
                  <a href="/kbe/labels/">Labels</a>
                
                  <a href="/kbe/deployments/">Deployments</a>
                
                  <a href="/kbe/services/">Services</a>
                
                  <a href="/kbe/sd/">Service Discovery</a>
                
                  <a href="/kbe/pf/">Port Forward</a>
                
                  <a href="/kbe/healthz/">Health Checks</a>
                
                  <a href="/kbe/envs/">Environment Variables</a>
                
                  <a href="/kbe/ns/">Namespaces</a>
                
                  <a href="/kbe/volumes/">Volumes</a>
                
                  <a href="/kbe/pv/">Persistent Volumes</a>
                
                  <a href="/kbe/secrets/">Secrets</a>
                
                  <a href="/kbe/logging/">Logging</a>
                
                  <a href="/kbe/jobs/">Jobs</a>
                
                  <a href="/kbe/statefulset/">Stateful Sets</a>
                
                  <a href="/kbe/ic/">Init Containers</a>
                
                  <a href="/kbe/nodes/">Nodes</a>
                
                  <a href="/kbe/api/">API Server</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Other topics</a>
              <div class="navlinks-children">
                
                  <a href="/kbe/topics/metallb/metallb/">MetalLB</a>
                
                  <a href="/kbe/topics/istio/istio/">Istio</a>
                
              </div>
            </li>
          
        
          
            <li>
              <a title="Contribute" href="https://github.com/openshift-evangelists/kbe">Contribute</a>
            </li>
          
        
          
            <li>
              <a title="Try out!" href="/kbe/diy/">Try out!</a>
            </li>
          
        

        

        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
          <a title="Kubernetes By Example" href="https://tonejito.github.io/">
            <img class="avatar-img" src="https://tonejito.github.io/kbe//img/kbe-logo.png" alt="Kubernetes By Example" />
          </a>
        
      </div>
    </div>

  </div>
</nav>




    
  
  
  




  <div class="intro-header"></div>


    
  <div class="container" role="main">
    <table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 10%;"/>
<col style="width: 80%;"/>
<col style="width: 10%;"/>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>¬†</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><a href="../../../">üè†</a></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><a href="../install">‚è©</a></p>
</div></div></td>
</tr>
</tbody>
</table>
<hr/>
<div class="sect1">
<h2 id="_istio">Istio</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Istio is an ingress controller and a service mesh implementation for Kubernetes.
It abstracts the traffic management logic from the application by using a sidecar container that manages all the incoming and outgoing network traffic for a pod.</p>
</div>
<div class="paragraph">
<p>Before istio, applications had to manage all the advanced network operations, retry logic and resiliency, adding complexity to the main logic.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Before Istio: Application with all the traffic managment logic</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><div class="content"><div class="imageblock text-center">
<div class="content">
<img src="../../../img/istio/istio-pod-container.png" alt="Before Istio" width="100%"/>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Istio injects a sidecar container that intercepts the ingress and egress traffic, controlling the communication between the application, the clients and the Kubernetes services.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">After Istio: Application with sidecar container</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><div class="content"><div class="imageblock text-center">
<div class="content">
<img src="../../../img/istio/istio-pod-sidecar-container-envoy.png" alt="After Istio" width="100%"/>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Istio implements the following features:</p>
</div>
<div class="ulist compact">
<ul class="compact">
<li>
<p>Inter-service communication</p>
</li>
<li>
<p>Service discovery</p>
</li>
<li>
<p>Load balancing</p>
</li>
<li>
<p>Resiliency</p>
</li>
<li>
<p>Metrics</p>
</li>
<li>
<p>Tracing</p>
</li>
<li>
<p>Fault injection</p>
</li>
<li>
<p>Mutual TLS</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_what_is_a_sidecar_container">What is a sidecar container?</h3>
<div class="paragraph">
<p>The <em>sidecar container</em> is an extra container that is added to a pod, this extra container handles a set of specialized operations to add features to an existing application without altering it.
The pattern name is inspired in the sidecar that is attached to a motorcycle, because the sidecar container is attached to the pod and connected to the main application.</p>
</div>
<div class="paragraph">
<p>Kubernetes defines the pod as the minimum unit that can be created and managed.
A pod can execute one or more containers in a context where namespaces, network, and volumes are shared between them.
Using a single container per pod is a common use case in which the application has all of the resources assigned to the pod.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Pod with a single container</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><div class="content"><div class="imageblock text-center">
<div class="content">
<img src="../../../img/istio/istio-pod-single-container.png" alt="Pod with a single container" width="100%"/>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Sometimes the application consists of multiple containers that are related to each other and need to share resources like network or storage.
The Istio sidecar container manages the network traffic, and the main container has the application logic.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Pod with a sidecar container</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><div class="content"><div class="imageblock text-center">
<div class="content">
<img src="../../../img/istio/istio-pod-sidecar-container.png" alt="Pod with a sidecar container" width="100%"/>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_what_is_a_service_mesh">What is a Service Mesh?</h3>
<div class="paragraph">
<p>The term <em>service mesh</em> refers to a technology used to manage communication between the microservices in an application.
It provides components such as traffic management, retry logic, metrics, and security.
Those components can be added to the application via a sidecar container that implements all extra features and serves as a proxy for the ingress and egress traffic of the pod.</p>
</div>
</div>
<div class="sect2">
<h3 id="_istio_components">Istio components</h3>
<div class="paragraph">
<p>Istio has two main components, a control plane that manages the configuration and a data plane that handles the communication between services.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Istio control plane and data plane</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><div class="content"><div class="imageblock text-center">
<div class="content">
<img src="../../../img/istio/istio-control-plane-data-plane.png" alt="Istio control plane and data plane" width="100%"/>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Control plane</dt>
<dd>
<p>The control plane injects the sidecar containers in the application pods.
It also manages the envoy proxies by sending the configuration updates as needed.
The envoy proxies do not need to contact the Istio control plane after they are configured.</p>
</dd>
<dt class="hdlist1">Data plane</dt>
<dd>
<p>All envoy proxies are interconnected in the service mesh.
Each proxy intercepts the network traffic directed to a pod and applies routing rules and redirects the ingress request to the application container, or egress request to the appropriate service.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_istio_installation_options">Istio installation options</h3>
<div class="paragraph">
<p>There are various methods to install MetalLB in a Kubernetes cluster.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install the Istio release with the <a href="https://istio.io/v1.12/docs/setup/install/istioctl/"><code>istioctl</code> tool</a>.</p>
</li>
<li>
<p>Add the <a href="https://istio-release.storage.googleapis.com/charts">chart repository</a> and deploy the <code>istio/base</code>, <code>istio/istiod</code> charts with <code>helm</code>. You can enable the ingress gateway by installing the <code>istio/gateway</code> chart.</p>
</li>
<li>
<p>Install with the <a href="https://istio.io/v1.12/docs/setup/install/multicluster/">Multicluster deployment model</a> to set up Istio in multiple Kubernetes clusters.</p>
</li>
<li>
<p>Install the <a href="https://istio.io/v1.12/docs/setup/install/operator/">Istio Operator</a> with <code>istioctl</code> or <code>helm</code>.</p>
</li>
<li>
<p>Enable the <code>istio-provisioner</code>, and <code>istio</code> add-ons in minikube.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Minikube provides Istio as an add-on.
However, the version is outdated and can‚Äôt be installed in recent versions of Kubernetes.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_istio_installation_profiles">Istio installation profiles</h3>
<div class="paragraph">
<p>Istio can be installed with different features turned on or off depending on the environment that will be deployed.</p>
</div>
<div class="paragraph">
<p>You can execute <code>istioctl profile dump</code> to inspect the details of the current profile.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Default</dt>
<dd>
<p>Enables the default settings, it is recommended for production deployments.</p>
</dd>
<dt class="hdlist1">Demo</dt>
<dd>
<p>Enables features to demonstrate tracing and the example applications.
It requires many resources.</p>
</dd>
<dt class="hdlist1">Minimal</dt>
<dd>
<p>Only install the control plane components to manage an external cluster.</p>
</dd>
<dt class="hdlist1">External</dt>
<dd>
<p>Install the components on a cluster that will be managed with an external control plane.</p>
</dd>
<dt class="hdlist1">Empty</dt>
<dd>
<p>It is an empty profile with all features disabled, it can be used to create custom configurations.</p>
</dd>
<dt class="hdlist1">Preview</dt>
<dd>
<p>Enables experimental features that are not stable.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_istio_add_ons">Istio add-ons</h3>
<div class="paragraph">
<p>The add-ons for Istio are installed from <a href="https://github.com/istio/istio/tree/1.12.1/samples/addons">the <code>samples/addons</code> directory</a> of the Istio release archive.</p>
</div>
<div class="ulist compact">
<ul class="compact">
<li>
<p>Kiali</p>
</li>
<li>
<p>Grafana</p>
</li>
<li>
<p>Prometheus</p>
</li>
<li>
<p>Jaeger</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_installing_istio_in_minikube">Installing Istio in Minikube</h3>
<div class="paragraph">
<p>Istio requires at least 4 vCPUs and 8 GB of RAM to run correctly in minikube.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ minikube start --cpus=4 --memory=8g
...output omitted...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The Istio minikube add-on is outdated and can‚Äôt be installed in recent versions of Kubernetes.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Download the Istio release archive from GitHub, and install the <code>istioctl</code> tool.
Then verify if the cluster meets the installation requirements.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ istioctl experimental precheck
‚úî No issues found when checking the cluster. Istio is safe to install or upgrade!
  To get started, check out https://istio.io/latest/docs/setup/getting-started/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Install Istio in the Kubernetes cluster using the appropriate profile for your deployment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ istioctl install --set profile=demo -y
‚úî Istio core installed
‚úî Istiod installed
‚úî Egress gateways installed
‚úî Ingress gateways installed
‚úî Installation complete
Making this installation the default for injection and validation.

Thank you for installing Istio 1.12.
Please take a few minutes to tell us about your install/upgrade experience!
https://forms.gle/FegQbc9UvePd4Z9z7</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_istio_ingress_gateway_endpoint">Istio Ingress Gateway Endpoint</h3>
<div class="paragraph">
<p>The Istio ingress gateway endpoint depends on the configuration of the underlying service.
Istio provides ports for HTTP and HTTPS connections.</p>
</div>
<div class="paragraph">
<p>The Istio <a href="../../istio/install">installation guided exercise</a> uses MetalLB to manage the ingress gateway load balancer service endpoint.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ kubectl get services -n istio-system
NAME                   TYPE           CLUSTER-IP       EXTERNAL-IP     PORT(S)                                 AGE
istio-egressgateway    ClusterIP      10.111.169.103   &lt;none&gt;          80/TCP,443/TCP                          5m
istio-ingressgateway   LoadBalancer   10.97.37.96      192.168.59.20   80:32031/TCP,443:31872/TCP,...          5m
istiod                 ClusterIP      10.103.227.204   &lt;none&gt;          443/TCP,15010/TCP,15012/TCP,15014/TCP   6m</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If Istio was installed using <code>helm</code>, then the ingress and egress resources are in the <code>istio-ingress</code> namespace.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Node port</dt>
<dd>
<p>The IP address of a node, and a port number.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">export INGRESS_HOST=$(kubectl get node ${NODE_NAME} \
  -o jsonpath=&#39;{.status.addresses[?(@.type==&#34;InternalIP&#34;)].address}&#39;)

export INGRESS_PORT=$(kubectl get service ${INGRESS_SERVICE} \
  -n ${INGRESS_NAMESPACE} \
  -o jsonpath=&#39;{.spec.ports[?(@.name==&#34;http2&#34;)].nodePort}&#39;)

export SECURE_INGRESS_PORT=$(kubectl get service ${INGRESS_SERVICE} \
  -n ${INGRESS_NAMESPACE} \
  -o jsonpath=&#39;{.spec.ports[?(@.name==&#34;https&#34;)].nodePort}&#39;)</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Load balancer</dt>
<dd>
<p>The IP address of a load balancer is provided by the cloud controller.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">export INGRESS_HOST=$(kubectl get service ${INGRESS_SERVICE} \
  -n ${INGRESS_NAMESPACE} -o jsonpath=&#39;{.status.loadBalancer.ingress[0].ip}&#39;)

export INGRESS_PORT=$(kubectl get service ${INGRESS_SERVICE} \
  -n ${INGRESS_NAMESPACE} -o jsonpath=&#39;{.spec.ports[?(@.name==&#34;http2&#34;)].port}&#39;)

export SECURE_INGRESS_PORT=$(kubectl get service ${INGRESS_SERVICE} \
  -n ${INGRESS_NAMESPACE} -o jsonpath=&#39;{.spec.ports[?(@.name==&#34;https&#34;)].port}&#39;)</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">External name</dt>
<dd>
<p>The endpoint is published as a DNS CNAME record.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">export INGRESS_HOSTNAME=$(kubectl get service ${INGRESS_SERVICE} \
  -n ${INGRESS_NAMESPACE} \
  -o jsonpath=&#39;{.status.loadBalancer.ingress[0].hostname}&#39;)</code></pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_sidecar_container_injection">Sidecar Container Injection</h3>
<div class="paragraph">
<p>The <code>istio-proxy</code> sidecar container can be manually injected in different ways.
The YAML resource manifest can be modified with <code>istioctl</code> to add the <code>istio-proxy</code> container to the pod definition.
You can create the resource using the modified YAML manifest.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ istioctl kube-inject -f deployment.yaml \
  -o deployment-injected.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another option is to modify and apply the YAML resource manifest in a single step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ kubectl apply -f &lt;(istioctl kube-inject -f resource.yaml)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also modify a resource that already exists on the cluster by exporting it to YAML, pipe the output to <code>istioctl</code> to inject the sidecar container definition, and then apply the patched resource to update.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ kubectl get deployment -o yaml | \
  istioctl kube-inject -f - | kubectl apply -f -</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_enable_automatic_sidecar_injection">Enable automatic sidecar injection</h4>
<div class="paragraph">
<p>Istio can automatically inject the sidecar container definition into the pods of a namespace.
You have to apply a label to the namespace to enable this feature.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ kubectl label namespace default \
  istio-injection=enabled --overwrite
namespace/default labeled</code></pre>
</div>
</div>
<div class="paragraph">
<p>New pods will have the <code>istio-proxy</code> container after the label is applied to the namespace.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ kubectl get pods -l app=nginx \
  -o jsonpath=&#39;{.items[0].spec.containers.*.name}{&#34;\n&#34;}&#39;
nginx istio-proxy</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can roll out an existing deployment to deploy new pods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ kubectl rollout restart deployment nginx
deployment.apps/nginx restarted</code></pre>
</div>
</div>
<div class="paragraph">
<p>Remove the label from the namespace to disable the automatic sidecar injection for new pods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[user@host kbe]$ kubectl label namespace default istio-injection-
namespace/default labeled</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The dash at the end of the command is used to instruct <code>kubectl</code> to remove the label.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<hr/>
<div class="paragraph">
<p>References</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://istio.io/v1.12/docs/" class="bare">https://istio.io/v1.12/docs/</a></p>
</li>
<li>
<p><a href="https://istio.io/v1.12/docs/setup/platform-setup/" class="bare">https://istio.io/v1.12/docs/setup/platform-setup/</a></p>
</li>
<li>
<p><a href="https://istio.io/v1.12/docs/setup/install/" class="bare">https://istio.io/v1.12/docs/setup/install/</a></p>
</li>
<li>
<p><a href="https://istio.io/v1.12/docs/reference/commands/istioctl/" class="bare">https://istio.io/v1.12/docs/reference/commands/istioctl/</a></p>
</li>
<li>
<p><a href="https://istio.io/v1.12/docs/reference/config/" class="bare">https://istio.io/v1.12/docs/reference/config/</a></p>
</li>
<li>
<p><a href="https://istio.io/v1.12/docs/ops/best-practices/deployment/" class="bare">https://istio.io/v1.12/docs/ops/best-practices/deployment/</a></p>
</li>
<li>
<p><a href="https://github.com/istio/istio/tree/1.12.1/samples/addons" class="bare">https://github.com/istio/istio/tree/1.12.1/samples/addons</a></p>
</li>
<li>
<p><a href="https://kubebyexample.com/en/concept/pods" class="bare">https://kubebyexample.com/en/concept/pods</a></p>
</li>
<li>
<p><a href="https://kubebyexample.com/en/learning-paths/operator-framework/kubernetes-api-fundamentals/side-car-pattern" class="bare">https://kubebyexample.com/en/learning-paths/operator-framework/kubernetes-api-fundamentals/side-car-pattern</a></p>
</li>
<li>
<p><a href="https://developers.redhat.com/books/introducing-istio-service-mesh-microservices" class="bare">https://developers.redhat.com/books/introducing-istio-service-mesh-microservices</a></p>
</li>
<li>
<p><a href="https://bit.ly/istio-intro" class="bare">https://bit.ly/istio-intro</a></p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 10%;"/>
<col style="width: 80%;"/>
<col style="width: 10%;"/>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>¬†</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><a href="../../../">üè†</a></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><a href="../install">‚è©</a></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>

  </div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
        </ul>
        <p class="credits copyright text-muted">
          
          &nbsp;&bull;&nbsp;
          2020

          
            &nbsp;&bull;&nbsp;
            <a href="https://tonejito.github.io/">Kubernetes By Example</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.91.2</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://tonejito.github.io/kbe//js/main.js"></script>
<script>

$('.language-test').parent().css('display', 'none')


var copybtns = {
  fallbackCopyTextToClipboard: function (text) {
    var txt = document.createElement("textarea");
    txt.value = text;
    
    
    txt.style.position = "fixed";
    txt.style.top = "0";
    txt.style.left = "0";
  
    document.body.appendChild(txt);
    txt.focus();
    txt.select();
    txt.setSelectionRange(0, 99999);
  
    try {
      var successful = document.execCommand('copy');
      var msg = successful ? 'successful' : 'unsuccessful';
    } catch (err) {
      console.error('Fallback: Unable to copy', err);
    }
  
    document.body.removeChild(txt);
  },
  copyTextToClipboard: function (text) {
    if (!navigator.clipboard) {
      copybtns.fallbackCopyTextToClipboard(text);
      return;
    }
    navigator.clipboard.writeText(text).then(function() {
      
    }, function(err) {
      
      copybtns.fallbackCopyTextToClipboard(text);
    });
  },
  flash: function(btn, content){
    
    content.fadeTo(50, 0.25, function() { $(this).fadeTo(300, 1.0); });
    
    btn.fadeTo(50, 0.0, function() { $(this).fadeTo(900, 1.0); });
  },
  txtClick : function(){
    var content = $(this);
    var btn = content.prev('button');
    
    copybtns.flash(btn, content);
    
    copybtns.copyTextToClipboard(content.text());
  },
  btnClick : function(){
    var btn = $(this);
    var content = $(btn.next().children()[0]);
    
    copybtns.flash(btn, content)
    
    copybtns.copyTextToClipboard(content.text());
  },
  init : function() {
    var buttonHTML = '<button type="button" data-toggle="tooltip" data-placement="top" title="Copy" class="copybtn btn btn-outline-dark"><img src="https:\/\/tonejito.github.io\/kbe\//img/Icon-Red_Hat-Media_and_documents-Paper_Stack_Blank-A-Black-RGB.png"/></button>';
    
    $('div.highlight').prepend(buttonHTML);
    
    $('button.copybtn').bind("click", copybtns.btnClick);
    $('div.highlight pre').bind("click", copybtns.txtClick);
  }
}
copybtns.init();
</script>
<script src="https://tonejito.github.io/kbe//js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> renderMathInElement(document.body); </script>






<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-34425776-2', 'auto');
	
	ga('send', 'pageview');
}
</script>



  </body>
</html>

